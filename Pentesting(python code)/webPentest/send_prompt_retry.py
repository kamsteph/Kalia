import time
import openai

def send_prompt_with_retry(prompt, retries=3, delay=5):
    """
    Essaie d'envoyer le prompt à l'API OpenAI/Groq jusqu'à `retries` fois.
    Attend `delay` secondes entre chaque tentative en cas d'erreur.
    Si toutes les tentatives échouent, l'exception est levée.
    """
    for attempt in range(1, retries + 1):
        try:
            response = openai.chat.completions.create(
                model="llama3-70b-8192",
                messages=[{"role": "user", "content": prompt}],
            )
            # Si la requête réussit, on retourne la réponse immédiatement
            return response.choices[0].message.content

        except openai.OpenAIError as e:
            print(f"[!] Tentative {attempt} sur {retries} échouée : {e}")
            if attempt < retries:
                print(f"Nouvelle tentative dans {delay} secondes...")
                time.sleep(delay)
            else:
                # Toutes les tentatives ont échoué, on remonte l'erreur
                raise
