from datetime import datetime
import os
import markdown2
import pdfkit

def export_to_markdown(summary_text, directory, p_type="network", context=""):
    os.makedirs(directory, exist_ok=True)

    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")

    filename = f"{p_type}_report_{context}_{timestamp}.md"
    file_path = os.path.join(directory, filename)

    title = "# Web App Pentest Report" if p_type == "web" else "# Network Scan Report"
    with open(file_path, "w") as f:
        f.write(f"{title} ({timestamp})\n\n")
        f.write(summary_text)

    print(f"[+] Markdown report saved to {file_path}")
    return file_path

def export_to_pdf(summary_text, directory,p_type="network", context=""):
    os.makedirs(directory, exist_ok=True)

    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"{p_type}_report_{context}_{timestamp}.pdf"
    file_path = os.path.join(directory, filename)

    html = markdown2.markdown(summary_text)
    pdfkit.from_string(html, file_path)

    print(f"[+] PDF report saved to {file_path}")
    return file_path

def export_report(summary_text, export_format="md", context="network", output_dir="."):
    saved_files = []

    if export_format in ["md", "both"]:
        md_path = export_to_markdown(summary_text, output_dir, context)
        saved_files.append(md_path)

    if export_format in ["pdf", "both"]:
        pdf_path = export_to_pdf(summary_text, output_dir, context)
        saved_files.append(pdf_path)

    return saved_files
