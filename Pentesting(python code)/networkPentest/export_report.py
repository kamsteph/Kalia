from datetime import datetime
import markdown2
import pdfkit

config = pdfkit.configuration(wkhtmltopdf='C:/Program Files/wkhtmltopdf/bin/wkhtmltopdf.exe')
def export_to_markdown(summary_text, context="network"):
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"report_{context}_{timestamp}.md"

    with open(filename, "w") as f:
        f.write(f"# Network Scan Report ({timestamp})\n\n")
        f.write(summary_text)

    print(f"[+] Markdown report saved to {filename}")
    return filename


def export_to_pdf(summary_text, context="network"):
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"report_{context}_{timestamp}.pdf"
    html = markdown2.markdown(summary_text)
    pdfkit.from_string(html, filename, configuration=config)

    print(f"[+] PDF report saved to {filename}")
    return filename


def export_report(summary_text, export_format="md"):
    saved_files = []

    if export_format == "md" or export_format == "both":
        md_path = "report.md"
        export_to_markdown(summary_text, md_path)
        saved_files.append(md_path)

    if export_format == "pdf" or export_format == "both":
        pdf_path = "report.pdf"
        export_to_pdf(summary_text, pdf_path)
        saved_files.append(pdf_path)

    return saved_files
