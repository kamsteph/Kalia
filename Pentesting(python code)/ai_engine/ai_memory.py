import sqlite3
import os

DB_PATH = os.path.abspath("ai_brain_history.db")  # Store in project root

def init_db():
    """Initialize the DB table if not already created."""
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute("""
        CREATE TABLE IF NOT EXISTS exploit_results (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            vuln_type TEXT,
            tool TEXT,
            success INTEGER,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        )
    """)
    conn.commit()
    conn.close()

def record_result(vuln_type, tool, success):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute(
        "INSERT INTO exploit_results (vuln_type, tool, success) VALUES (?, ?, ?)",
        (vuln_type, tool, int(success))
    )
    conn.commit()
    conn.close()

def is_successful(result):
    if isinstance(result, dict):
        return result.get("vulnerable") is True
    return "success" in result.lower() or "shell" in result.lower() or "session" in result.lower()
