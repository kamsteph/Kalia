import 'dart:convert';
import 'package:http/http.dart' as http;

class NetworkScanAPI {
  static Future<String> runScan(String targetIp, String export) async {
    final url = Uri.parse('http://127.0.0.1:8888/start-network-vuln-scan');

    try {
      final response = await http.post(
        url,
        headers: {'Content-Type': 'application/json'},
        body: jsonEncode({
          'target': targetIp,
          'export': export,
        }),
      );

      if (response.statusCode == 200) {
          return "✅ Scan lancé avec succès : ${response.body}";
      } else {
        return "❌ Erreur serveur : ${response.statusCode} ${response.body}";
      }
    } catch (e) {
      return "❌ Exception lors de l'appel API : $e";
    }
  }
  static Future<String> networkPentestAttack(dynamic results,bool canProceed,String baseUrl) async {
    final url = Uri.parse(baseUrl);

    try {
      final response = await http.post(
        url,
        headers: {'Content-Type': 'application/json'},
        body: jsonEncode({
          "vuln_scan_data": results,
          "can_proceed": canProceed,
        }),
      );

      if (response.statusCode == 200) {
        return "✅ The attack has been performed and the AI was successful at taking control as a superAdmin: ${response.body}";
      } else {
        return "❌ Server error: ${response.statusCode} ${response.body}";
      }
    } catch (e) {
      return "❌ Exception during API call: $e";
    }
  }

}
