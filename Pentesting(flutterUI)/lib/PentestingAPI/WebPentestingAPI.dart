import 'dart:convert';
import 'package:http/http.dart' as http;

class WebScanAPI {
  static Future<String> runScan(String url,
      {String? social, String report = "both"}) async {
    try {
      final apiUrl = Uri.parse('http://127.0.0.1:5000//start-web-vuln-scan');

      final response = await http.post(
        apiUrl,
        headers: {'Content-Type': 'application/json'},
        body: jsonEncode({
          "url": [url],
          if (social != null && social.isNotEmpty) "social": [social],
          "export": report,
        }),
      );

      if (response.statusCode == 200) {
        return "✅ Scan lancé avec succès : ${response.body}";
      } else {
        return "❌ Erreur API : ${response.statusCode} - ${response.body}";
      }
    } catch (e) {
      return "❌ Exception HTTP : $e";
    }
  }
}
