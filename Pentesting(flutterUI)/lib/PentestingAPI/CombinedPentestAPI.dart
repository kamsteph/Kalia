import 'dart:convert';
import 'package:http/http.dart' as http;

class CombinedScanAPI {
  /// Run combined pentest with network IPs, web URLs, social URLs, and export format.
  ///
  /// - [networkIps]: List of target IP addresses for network pentest.
  /// - [webUrls]: List of target URLs for web pentest.
  /// - [socialUrls]: Optional list of social media URLs for web pentest OSINT.
  /// - [export]: Report format ("pdf", "md", or "both").
  ///
  /// Returns a status string describing the result or error.

  static Future<String> pentestAttack(dynamic results,bool canProceed,String baseUrl) async {
    final url = Uri.parse(baseUrl);

    try {
      final response = await http.post(
        url,
        headers: {'Content-Type': 'application/json'},
        body: jsonEncode({
          "vuln_scan_data": results,
          "can_proceed": canProceed,
        }),
      );

      if (response.statusCode == 200) {
        return "✅ The attack has been performed and the AI was successful at taking control as a superAdmin: ${response.body}";
      } else {
        return "❌ Server error: ${response.statusCode} ${response.body}";
      }
    } catch (e) {
      return "❌ Exception during API call: $e";
    }
  }

// static Future<String> runScan({
  //   List<String>? networkIps,
  //   List<String>? webUrls,
  //   List<String>? socialUrls,
  //   String export = "both",
  //   required bool canProceed
  // }) async {
  //   final url = Uri.parse('http://127.0.0.1:8888/start-all-pentest'); // Replace YOUR_PORT with your backend port
  //
  //   try {
  //     final body = <String, dynamic>{
  //       if (networkIps != null && networkIps.isNotEmpty) 'network_ips': networkIps,
  //       if (webUrls != null && webUrls.isNotEmpty) 'web_urls': webUrls,
  //       if (socialUrls != null && socialUrls.isNotEmpty) 'social_urls': socialUrls,
  //       'export': export,
  //       'canProceed': canProceed
  //     };
  //
  //     final response = await http.post(
  //       url,
  //       headers: {'Content-Type': 'application/json'},
  //       body: jsonEncode(body),
  //     );
  //
  //     if (response.statusCode == 200) {
  //       return "✅ Scan lancé avec succès : ${response.body}";
  //     } else {
  //       return "❌ Erreur API : ${response.statusCode} - ${response.body}";
  //     }
  //   } catch (e) {
  //     return "❌ Exception HTTP : $e";
  //   }
  // }
}
